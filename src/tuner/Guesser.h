#include "../Helpers.h"

class Guesser{
    public: 
        float gamePhase;
        std::array<int, 6> pieceDiff;

        static constexpr float totalPhase = 128.0;
        static constexpr std::array<float, 6> phases = {0.0, 14.0, 8.0, 5.0, 4.0, 2.0};

        Table<float, 6, 64> midpst = 
        {{{-3, 0, 4, 7, 7, 8, 2, 0, 
        0, 8, 9, 7, 8, 3, 9, 2, 
        -9, 13, 24, 15, 17, 20, 8, 3, 
        -18, 13, 24, 26, 30, 15, 33, -13, 
        -44, -58, 0, 18, -22, 8, -5, -7, 
        -43, -50, -36, -96, -83, -44, -46, -26, 
        59, 22, -23, -68, -19, 0, 3, 33, 
        -2, 49, 37, 18, 22, 33, 39, 54}, 

        {5, -3, 15, 23, 37, -2, -8, -9, 
        9, -4, 27, 34, 40, 19, -18, -4, 
        -23, 47, 64, 51, 55, 63, 27, -6, 
        -4, -8, 18, 34, 19, 17, -7, 6, 
        0, -8, 0, 3, 11, -12, -6, -10, 
        -11, -4, -6, -21, -12, -10, -5, -27, 
        -30, -25, 0, -10, 0, 5, -13, -37, 
        -38, -21, -6, 3, 0, -10, -22, -30}, 

        {42, 42, 26, 10, 42, 39, 21, 36, 
        27, 42, 78, 80, 72, 47, 61, 21, 
        7, 32, 68, 65, 57, 66, 54, 27, 
        -31, 2, 5, 21, 9, -1, -1, -23, 
        -58, -34, -33, -55, -40, -49, -45, -39, 
        -78, -54, -26, -50, -63, -50, -73, -65, 
        -51, -35, -43, -24, -11, -33, -58, -57, 
        -59, -46, -22, -22, -24, -27, -42, -54}, 

        {-13, -7, -15, -8, -10, -8, -15, -24, 
        -23, 1, 25, 16, 9, 5, 11, -9, 
        -7, 55, 57, 86, 91, 63, 50, 1, 
        22, 16, 42, 78, 98, 50, 39, -2, 
        1, 33, 29, 43, 46, 43, 9, 3, 
        -3, 2, 10, 0, 9, 6, 0, 0, 
        -29, -4, -4, 5, 1, -6, -7, -25, 
        -24, -31, -9, -22, -9, -12, -27, -26}, 

        {-31, -26, 0, -4, 0, -3, -23, -24, 
        -56, -12, 30, 52, 50, 34, -11, -17, 
        21, 53, 53, 122, 123, 100, 87, -4, 
        8, 55, 60, 89, 84, 72, 27, 7, 
        0, 20, 45, 52, 46, 48, 6, -13, 
        -17, -2, 9, 8, 7, 10, -18, -19, 
        -36, -9, 0, -4, -6, -19, -31, -45, 
        -42, -28, -16, -29, -11, -29, -49, -62}, 

        {0, 0, 0, 0, 0, 0, 0, 0, 
        64, 39, 42, 50, 53, 43, 72, 28, 
        -76, 0, -12, 5, -19, -21, -27, -98, 
        -79, -55, -48, -36, -39, -40, -64, -98, 
        -85, -51, -49, -52, -42, -53, -67, -95, 
        -88, -49, -61, -67, -61, -67, -60, -97, 
        -95, -61, -68, -80, -73, -76, -72, -102, 
        0, 0, 0, 0, 0, 0, 0, 0}}}; 

        Table<float, 6, 64> endpst = 
        {{{-30, -11, -3, 8, 14, 1, -5, -29, 
        -5, 25, 14, 28, 28, 36, 16, 9, 
        5, 32, 43, 42, 47, 12, 40, 4, 
        6, 21, 34, 36, 30, 41, 9, 0, 
        -15, 24, 23, 21, 31, 14, 2, -14, 
        -13, 0, 19, 31, 36, 11, 7, -14, 
        -67, -23, -3, 8, 6, 2, -20, -46, 
        -62, -70, -64, -75, -81, -72, -64, -81}, 

        {-5, 15, 25, 18, 19, 33, 3, -2, 
        -7, 45, 31, 45, 59, 28, 27, 15, 
        34, 32, 45, 43, 48, 32, 15, 4, 
        11, 31, 57, 63, 50, 49, 27, 0, 
        -3, 19, 36, 58, 52, 23, -20, -13, 
        -51, -19, 0, 8, 3, 19, -16, -28, 
        -22, -40, -41, -52, -45, -63, -50, -48, 
        -51, -49, -101, -98, -79, -74, -64, -82}, 

        {9, 14, 29, 26, 19, 17, 18, 22, 
        10, 12, 5, 7, 2, 10, 8, 17, 
        11, 14, 8, 14, 1, 14, 6, 10, 
        24, 18, 17, 13, 15, 15, 19, 15, 
        9, 9, 10, 26, 22, 28, 15, -5, 
        1, -2, -17, 10, 12, 6, 15, 0, 
        -21, -35, -9, -29, -22, -19, -18, -26, 
        -7, -1, -4, -1, -7, 2, 8, -3}, 

        {3, 11, -18, 6, 0, -10, -2, -5, 
        -11, 8, 0, 12, 2, 6, 13, 2, 
        -11, -6, 12, 1, -2, 4, 8, -11, 
        -22, 35, 22, 4, 4, 6, 13, -1, 
        8, -5, 20, 23, 16, 17, 7, -3, 
        -16, -7, 6, 16, 14, 13, -5, -35, 
        -45, -44, -16, -24, -9, -35, -42, -40, 
        -155, -64, -53, -31, -48, -52, -87, -111}, 

        {-32, 1, -4, -20, -1, -6, -18, -27, 
        -21, 8, 8, 3, 4, 13, 1, -22, 
        -10, 5, 22, 9, 10, 8, 12, -12, 
        -2, -3, 27, 18, 22, 17, 29, -14, 
        -4, 4, 23, 13, 31, 17, 5, -19, 
        -36, -18, 8, 23, 38, 5, -1, -37, 
        -11, -21, -20, -18, 0, -16, -24, -37, 
        -139, -77, -49, -40, -25, -62, -66, -77}, 

        {0, 0, 0, 0, 0, 0, 0, 0, 
        136, 162, 128, 109, 128, 135, 147, 152, 
        101, 89, 70, 42, 64, 76, 102, 114, 
        47, 32, 2, -15, -6, 0, 32, 56, 
        12, 9, -22, -20, -18, -7, 17, 16, 
        4, -11, -6, 2, -7, -8, 4, 13, 
        18, 3, 9, 21, 16, 10, 16, 14, 
        0, 0, 0, 0, 0, 0, 0, 0}}};

        std::array<float, 6> material = {0, 1240, 664, 500, 460, 160};
        std::array<float, 6> endmaterial = {0, 1048, 506, 284, 257, 136};
        float tempo = 5;

        std::array<int, 16> stmactive;
        std::array<int, 16> nstmactive;
        Count numStm, numNstm;

        float fromBullet(const Bullet&);
        void report(int);
};